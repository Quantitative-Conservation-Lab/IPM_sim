---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Something here about background?

# Scripts, current version
## 0 - preparing scenarios
### compute_time_calc.R
Code for approximating the total run time, given number of simulated datasets, number of parameter scenarios, computer cores, and estimated run time. 
### generate_scenarios.R
Function 'getNviable' for finding the combinations of parameters that give a population growth rate ($\lambda$) within certain bounds, using the eigenvalue from the Leslie matrix. The output from this function produced the parameter scenarios used to simulate population trajectories, observation data from the trajectories, and fit the the IPM models. 

## 1 - simulating data
### IPM_sim_2.0function.R
Script contains two functions for simulating data: 'simPopTrajectory' and 'simData'. 
The 'simPopTrajectory' function simulates the true population trajectory by individuals and through age classes, starting from the stable age distribution. Individual fates are monitored throughout, to use for generating each of the IPM datasets. 

The 'simData' function uses the output from the 'simPopTrajectory' function to simulate the observation process for each data type. The true individual data is broken down into independent sets and each is subject to a observation error. Mark-resight, count, and reproductive success data are output from this function. 

### simulateTrajectories.R

Script that pulls from the scenarios that were created in '0 - preparing scenarios' and the functions in IPM_sim_2.0function.R to simulate datasets for model fitting. 


## 2 - models

### IPMinitvalues.R
Functions for putting data in the form required by the survival model. 

### IPM_marray.R
Script contains 4 IPM NIMBLE models. 1.) full IPM model ('IPMmod') where all three datasets are included, 2.) model without productivity dataset ('nonests'), 3.) model without survival model ('nomr'), and 4.) abundance only model without productivity or survival ('abundonly'). 

## 3 - run models
### run_scenarios_helperFns.R
Script with functions and code to run NIMBLE models. Function 'marray' transforms the survival data capture histories to m-array format. MCMC settings set in this script, with functions for each of the 4 models. Each model has a run model function that defines constants, initial values, data, parameters to monitor, and code to build/run the models in NIMBLE. 

### run_scenarios.R
Script that pulls from the scripts above to run models in parallel and output results. 

## 4 - process results
### 01_load_and_process_data.R
Script that checks the Gelman-Rubin convergence statistic for each output MCMC sample, then thins the chains to reduce file size and places the output into categories based on the population growth rate, $\lambda$. 

### 02_compute_geom_means.R
Computes the geometric means for $\lambda$ in each MCMC output. 

# Data
Contains true parameter scenarios used to simulate population trajectories and observation data, all viable parameter cominations in files '-.lam.combos.RDS' and the selected parameter combinations used to simulate data are in files '-.lam.params.RDS' (where "-" is low, med, or high). Folders labeled '-Trajectories' contain the simulated population trajectories for each of the scenarios found in '-.lam.params.RDS'. Each simulated trajectory is labeled with the scenario and the simulation number for that scenario. For example, in the highTrajectory folder: highpopTraj-1-2.RDS corresponds to the first parameter scenario in high.lam.param.RDS and is the second population trajectory simulated using those parameter values. 
File 'true.vals.csv' is a file for the true parameter values used in each scenario. 'scenario_ID.csv' tracks the combinations of detection parameters and IPM models. 







